name: Dockstore

on: [push]
  # release:
  #   types: [created]

jobs:
  deploy:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v1
      with:
        python-version: '3.7'

    - name: Install Dockstore dependencies
      run: |
        add-apt-repository ppa:openjdk-r/ppa && apt-get update -q && apt install -y openjdk-11-jdk
        mkdir -p ~/bin
        curl -L -o ~/bin/dockstore https://github.com/dockstore/dockstore/releases/download/1.9.0/dockstore
        chmod +x ~/bin/dockstore
        echo 'export PATH=~/bin:$PATH' >> ~/.bashrc
        source ~/.bashrc
        mkdir -p ~/.dockstore
        printf "token: ${{secrets.DOCKSTORE_TOKEN}}\nserver-url: https://dockstore.org/api\n" > ~/.dockstore/config

    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyyaml
        python dockstore.py tests/test-descriptions.yaml \
        ${GITHUB_REF#refs/heads/} \
        sagebionetworks/synapsepythonclient \
        git@github.com:Sage-Bionetworks-Workflows/dockstore-tool-synapseclient.git
