name: Dockstore

on: [push]
  # release:
  #   types: [created]

jobs:
  deploy:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v1
      with:
        python-version: '3.7'

    - name: Install Dockstore dependencies
      run: |
        sudo add-apt-repository ppa:openjdk-r/ppa && sudo apt-get update -q && sudo apt install -y openjdk-11-jdk
        mkdir -p ~/bin
        curl -L -o ~/bin/dockstore https://github.com/dockstore/dockstore/releases/download/1.9.0/dockstore
        chmod +x ~/bin/dockstore
        mkdir -p ~/.dockstore
        echo `java -version`
        printf "token: ${{secrets.DOCKSTORE_TOKEN}}\nserver-url: https://dockstore.org/api\n" > ~/.dockstore/config

    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyyaml
        export PATH=~/bin:$PATH
        python dockstore.py tests/test-descriptions.yaml \
        ${GITHUB_REF#refs/*/} \
        sagebionetworks/synapsepythonclient \
        git@github.com:Sage-Bionetworks-Workflows/dockstore-tool-synapseclient.git
